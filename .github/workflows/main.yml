name: LinkGeÃ§ Deploy & Keep Alive

on:
  push:
    branches: [ main, master ]
  schedule:
    - cron: '*/15 * * * *'  # Her 15 dakikada bir Ã§alÄ±ÅŸtÄ±r (aktif tut)
  workflow_dispatch:  # Manuel tetikleme

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Test app startup
      run: |
        echo "ğŸš€ LinkGeÃ§ uygulamasÄ± baÅŸlatÄ±lÄ±yor..."
        timeout 30 python app.py &
        APP_PID=$!
        sleep 10
        
        # Test et
        if curl -f http://localhost:5001 > /dev/null 2>&1; then
          echo "âœ… App baÅŸarÄ±yla Ã§alÄ±ÅŸÄ±yor!"
          echo "ğŸ“± Ana sayfa: http://localhost:5001"
          echo "ğŸ”§ Admin panel: http://localhost:5001/admin"
          echo "ğŸ‘¤ GiriÅŸ: admin / admin123"
        else
          echo "âŒ App baÅŸlatÄ±lamadÄ±!"
          exit 1
        fi
        
        # Process'i sonlandÄ±r
        kill $APP_PID 2>/dev/null || true
        
    - name: Deploy to Render/Railway (Simulation)
      run: |
        echo "ğŸŒ Deployment simÃ¼lasyonu..."
        echo "ğŸ“‹ GerÃ§ek deployment iÃ§in:"
        echo "1. Render.com'a git"
        echo "2. Web Service oluÅŸtur"
        echo "3. GitHub repo'yu baÄŸla"
        echo "4. Build command: pip install -r requirements.txt"
        echo "5. Start command: python app.py"
        echo "6. Port: 5001"
        echo ""
        echo "ğŸ”— Alternatif platformlar:"
        echo "- Railway.app"
        echo "- Heroku"
        echo "- DigitalOcean App Platform"
        echo "- PythonAnywhere"
        
    - name: Keep Alive Ping
      if: github.event_name == 'schedule'
      run: |
        echo "ğŸƒ Keep-alive ping Ã§alÄ±ÅŸÄ±yor..."
        echo "â° Son Ã§alÄ±ÅŸma: $(date)"
        echo "ğŸ”„ Bir sonraki ping: 15 dakika sonra"
        
        # GitHub Pages'e ping at (eÄŸer varsa)
        if curl -f "https://$(echo $GITHUB_REPOSITORY | tr '[:upper:]' '[:lower:]' | sed 's/\//.github.io\//')" > /dev/null 2>&1; then
          echo "âœ… GitHub Pages aktif"
        fi
        
    - name: Create deployment status
      run: |
        echo "ğŸ“Š Deployment durumu:"
        echo "âœ… Kod kontrolÃ¼: BaÅŸarÄ±lÄ±"
        echo "âœ… Dependencies: YÃ¼klendi"
        echo "âœ… App testi: GeÃ§ti"
        echo "â° Son gÃ¼ncelleme: $(date)"
        echo ""
        echo "ğŸŒ CanlÄ± deployment iÃ§in Render.com kullan:"
        echo "https://render.com"
        echo ""
        echo "ğŸ”§ HÄ±zlÄ± deployment komutu:"
        echo "git clone $GITHUB_SERVER_URL/$GITHUB_REPOSITORY"
        echo "cd $(basename $GITHUB_REPOSITORY)"
        echo "pip install -r requirements.txt"
        echo "python app.py"
