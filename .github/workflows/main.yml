name: LinkGeÃ§ Test & Deploy Guide

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # Manuel demo iÃ§in

jobs:
  test-and-deploy-guide:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Get Public IP & Start Server
      run: |
        echo "ğŸŒ GitHub Actions Public IP bilgisi alÄ±nÄ±yor..."
        
        # Public IP'yi al
        PUBLIC_IP=$(curl -s https://ipv4.icanhazip.com)
        echo "ğŸ“ GitHub Actions Public IP: $PUBLIC_IP"
        
        # Network info
        echo "ğŸ”§ Network Configuration:"
        ip route get 8.8.8.8 | head -1
        
        # Port aÃ§Ä±lÄ±mÄ±nÄ± kontrol et
        echo "ğŸ” Port durumu kontrol ediliyor..."
        sudo netstat -tlnp | grep :5001 || echo "Port 5001 boÅŸ"
        
        echo "ğŸš€ LinkGeÃ§ uygulamasÄ± baÅŸlatÄ±lÄ±yor..."
        
        # Flask'Ä± public IP'de Ã§alÄ±ÅŸtÄ±r
        sed -i "s/app.run(host='0.0.0.0'/app.run(host='$PUBLIC_IP'/g" app.py
        
        # Flask uygulamasÄ±nÄ± baÅŸlat
        python app.py &
        FLASK_PID=$!
        sleep 10
        
        # Local test
        if curl -f http://localhost:5001 > /dev/null 2>&1; then
          echo "âœ… Flask app localhost'ta Ã§alÄ±ÅŸÄ±yor!"
        else
          echo "âŒ Flask app baÅŸlatÄ±lamadÄ±!"
          kill $FLASK_PID 2>/dev/null || true
          exit 1
        fi
        
        # Public IP test
        echo "ğŸŒ Public eriÅŸim testi..."
        if curl -f http://$PUBLIC_IP:5001 > /dev/null 2>&1; then
          echo "ğŸ‰ LinkGeÃ§ public olarak eriÅŸilebilir!"
          echo "ğŸŒ Ana sayfa: http://$PUBLIC_IP:5001"
          echo "ğŸ”§ Admin panel: http://$PUBLIC_IP:5001/admin"
          echo "ğŸ‘¤ GiriÅŸ: admin / admin123"
          echo "â° Actions sÃ¼resi boyunca aktif (max 6 saat)"
          
          # GitHub Pages README'ye link ekle
          echo "# ğŸ”— CanlÄ± Demo" > DEMO_LINK.md
          echo "" >> DEMO_LINK.md
          echo "**LinkGeÃ§ ÅŸu anda canlÄ±!**" >> DEMO_LINK.md
          echo "" >> DEMO_LINK.md
          echo "ğŸŒ **Ana Sayfa:** http://$PUBLIC_IP:5001" >> DEMO_LINK.md
          echo "ğŸ”§ **Admin Panel:** http://$PUBLIC_IP:5001/admin" >> DEMO_LINK.md
          echo "ğŸ‘¤ **GiriÅŸ:** admin / admin123" >> DEMO_LINK.md
          echo "" >> DEMO_LINK.md
          echo "â° **Aktif SÃ¼re:** Bu Actions job'Ä± boyunca (max 6 saat)" >> DEMO_LINK.md
          echo "ğŸ”„ **Yeniden BaÅŸlat:** Actions'da 'Run workflow' butonuna bas" >> DEMO_LINK.md
          
          # 6 saat bekle (GitHub Actions max sÃ¼resi)
          echo "ğŸ’¤ 6 saat boyunca aktif tutulacak..."
          sleep 21600
        else
          echo "âš ï¸  Public IP eriÅŸimi mÃ¼mkÃ¼n deÄŸil (GitHub kÄ±sÄ±tlamasÄ±)"
          echo "ğŸ”§ Alternatif Ã§Ã¶zÃ¼mler:"
          echo "1. Codespaces kullan"
          echo "2. Render.com'a deploy et"
          echo "3. Railway.app kullan"
        fi
        
        # Temizlik
        kill $FLASK_PID 2>/dev/null || true
        
    - name: Create Status Report
      run: |
        echo "ğŸ“Š LinkGeÃ§ Demo Raporu"
        echo "========================="
        echo "âœ… Flask uygulamasÄ±: Test edildi"
        echo "âœ… Dependencies: YÃ¼klendi"
        echo "â° Son Ã§alÄ±ÅŸma: $(date)"
        echo ""
        echo "ğŸŒ CanlÄ± demo iÃ§in:"
        echo "1. Actions sekmesinde bu workflow'u Ã§alÄ±ÅŸtÄ±r"
        echo "2. 'Start Flask App & Create Public Link' adÄ±mÄ±nÄ± izle" 
        echo "3. ngrok linkini kopyala"
        echo "4. 2 saat boyunca aktif kalÄ±r"
        echo ""
        echo "ğŸš€ KalÄ±cÄ± deployment iÃ§in:"
        echo "â€¢ Render.com: https://render.com"
        echo "â€¢ Railway.app: https://railway.app"
        echo "â€¢ PythonAnywhere: https://pythonanywhere.com"
        echo ""
        echo "ğŸ“‹ Manuel kurulum:"
        echo "git clone $GITHUB_SERVER_URL/$GITHUB_REPOSITORY"
        echo "cd $(basename $GITHUB_REPOSITORY)"
        echo "pip install -r requirements.txt"
        echo "python app.py"
        echo ""
        echo "ğŸ”§ Admin giriÅŸ:"
        echo "KullanÄ±cÄ±: admin"
        echo "Åifre: admin123"
